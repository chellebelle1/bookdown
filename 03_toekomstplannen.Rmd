# MALDIquant 

## Intro 
Door mijn intresse in bacteriÃ«n en virussen heb ik in mijn derde jaar gekozen voor de specialisatie microbiologie. Hierbij moest ik voor een project werken met de bacterie _Porphyromonas gingivalis_. De bacterie werd hierbij blootgesteld aan verschillende concentraties magnesium en ijzer. Om het effect hiervan te meten op het aantal uitgescheiden outer membrane vesicles (OMV's), werd er gebruik gemaakt van een fluorescentie microscoop en MALDI-TOF MS. 

Voor MALDI-TOF MS data bestaat er een package genaamd MALDIquant, met een complete pipeline voor analyse. Omdat ik de MALDI-TOF MS een interessante techniek vind in de microbiologie, lijkt het me leuk om uit te zoeken hoe deze package werkt. 
Door op internet informatie te vinden over de package zou ik deze willen toepassen op mijn vorige project om de resultaten die ik toen had en nu heb te vergelijken. Hiermee zou ik in 4 dagen mee kunnen beginnen. 

De eerste twee dagen zal ik vooral oefenen met het gebruik van de package. Op internet zijn er verschillende manuals te vinden en die zou ik kunnen doorlopen met fake-data. Vervolgens kan ik proberen of ik de package kan laten runnen op mijn eigen data.  

## start 


```{r, echo=TRUE, eval=TRUE}
# Installeer de juiste packages 
# install.packages(c("MALDIquant", "MALDIquantForeign"))
library(MALDIquant)

# MALDIquant objects 
s <- createMassSpectrum(mass=1:10, intensity=1:10,
                        metaData=list(name="Spectrum1"))
s

# importeer voorbeeld data 
# subset van MALDI-TOF data van Fiedler et al(2009)
data("fiedler2009subset")
length(fiedler2009subset)
fiedler2009subset[1:2]

# quality control: alle spectra hetzelfde aantal data punten die niet leeg zijn
any(sapply(fiedler2009subset, isEmpty))
table(sapply(fiedler2009subset, length))

all(sapply(fiedler2009subset, isRegular))

# plot
plot(fiedler2009subset[[1]])
plot(fiedler2009subset[[16]])
fiedler2009subset[16]

# variance stabilization 
spectra <- transformIntensity(fiedler2009subset,
                              method = "sqrt")
# smoothing 
spectra <- smoothIntensity(spectra, method="SavitzkyGolay",
                           halfWindowSize=10)

# baseline correction
baseline <- estimateBaseline(spectra[[16]], method="SNIP",
                              iterations=100)
plot(spectra[[16]])
lines(baseline, col="red", lwd=2)

spectra <- removeBaseline(spectra, method="SNIP",
                           iterations=100)
plot(spectra[[1]])

# normalisatie 
spectra <- calibrateIntensity(spectra, method="TIC")

# alignment 
spectra <- alignSpectra(spectra,
                        halfWindowSize=20,
                        SNR=2,
                        tolerance=0.002,
                        warpingMethod="lowess")

samples <- factor(sapply(spectra,
                          function(x)metaData(x)$sampleName))

avgSpectra <- averageMassSpectra(spectra, labels=samples,
                                  method="mean")

# Peak detectie 
noise <- estimateNoise(avgSpectra[[1]])
 plot(avgSpectra[[1]], xlim=c(4000, 5000), ylim=c(0, 0.002))
 lines(noise, col="red")
 lines(noise[,1], noise[, 2]*2, col="blue")
 
peaks <- detectPeaks(avgSpectra, method="MAD",
                       halfWindowSize=20, SNR=2)
plot(avgSpectra[[1]], xlim=c(4000, 5000), ylim=c(0, 0.002))
points(peaks[[1]], col="red", pch=4)
  
# peak binning  
peaks <- binPeaks(peaks, tolerance=0.002)

# feature matrix 
peaks <- filterPeaks(peaks, minFrequency=0.25)
featureMatrix <- intensityMatrix(peaks, avgSpectra)
head(featureMatrix[, 1:3])
```
